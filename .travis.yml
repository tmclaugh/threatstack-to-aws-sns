language: python
python:
- '3.6'
install: pip install -r requirements.txt -t .
script:
- true
after_success:
- mkdir dist
- find ./ -name '*.pyc' -delete
- zip -r dist/threatstack-to-aws-sns.zip . -x '.git/*' -x 'dist/*'
- cat deploy/cloudformation.json | sed "s,%%SHA256%%,$(openssl dgst -r -sha256 dist/threatstack-to-aws-sns.zip | cut -f 1 -d ' ')," > dist/threatstack-to-aws-sns.json
- ls -al dist
- cat dist/threatstack-to-aws-sns.json
deploy:
  skip_cleanup: true
  provider: s3
  access_key_id:
    secure: unMz+XII7f3dRuTcZxbxRvwXZnT+0XKoJQ+lCu2BILFFd+qyqYarZBaSAr1jMxRN1bprzA/QhgQwzPK4UkFFDetqUPkO2VyizuBgedo7cAf3Qym8OyOc9LzaxxuTu+IkHt5dYUBID4GM5VDk4+4LTp6DBq7+9hvB6gxMPysio/WUCwvYJsnKhBmAfjv7OxF7r0njnzH+xyDvzanY96b+XlxIK5oqI6kucQtgXJ3o0Yfj2KCVFo5whH8qaiMMz+ouKPBpEn9mbO3IsO23AHIa5iR/uPOLJPryGlBg11LMHQZ4UuWzo7FQe6r/Yg4+QOz7I5RLQTK2Vb+4y8zBXAkclFckPVlsWsY8+85a2kawJJL4zDWjUb4QC2srCrt9D6JmNOsc3xS/NEBVuefKxUBceiw7LSKX/o1Nn6jfYyLR+83FclQjqZymFw90eESE+Z7lBIqBvLRUnTrwh/o1B19giL3ZCrH6112il3Hcw2pX5ozifu7EbdJcZIBNUghNSertglkCHeaROvI0HP/pchot816oxPjZBJ+OGaAP42KcVMUylmUqN1MtZQw+rbZ+wPoZhR56ttqiFnZ/Wh4PQhVBLzP4gcJanBpo4g1Y10qomkvPyG3lEi4jtpq4719Un8/phLTJagzeY+yUipihdreO1RL7q+MN+XAc18QYxNq7534=
  secret_access_key:
    secure: gLE/FPaNw09GEQsgwCDk+4g/Di1gd09UkTU7sXfHvGM2cFDfyvUHCxJU2bZLETCCmFRq1X1upLSydNFw1XuYPu7uPaKEaxeqavo/s25Ib66+ywt+oUrg4WYRbW0nRR8scRlNvEFktMxQroR3mlq5A1+ytIqMSXn+3aJa6ThbywIR6Ccjzfl9BqBOyM7p01ljnC7WtjX1USnaPrvjPCFLgt6A3HMdv0twW54Tc7Qm50YgwiEK8ksVtG4JwxcwVFYhjyFiGJlMXy0t1HePAg6PSOPsFDEVTFS7reNhi5xeLxKXGswLA4Ho1bfHLTbw0sPBQFDvTY0qk7DyvWn1uMIbDvrX8vrQNgbvQsxOzHLJQ5m11uXI5elgzV9I1XBD5HNn853gVpcVIeZ2LMGSX8w0KUg1gUkTJOQhrNZRN1uTUtEUhsmQIDrww2fyGWozE2LgVVf2p+pJL75LbGzsGlusm81bfY6vbTDzHB2bqsdgpV15aiVp+rjSPinyLMv+I6+xGbAh/RR1Bf9q/GPgJnohnQQSG1aUcZ03TI1k6jll+Edqvh/KoSuokWDUjLzUebEFhWX4boYbpm0ioTaf7UvctSIl0ZPHbx+MI5S/yivK0DxX6pebaEi5Co8OhnYJQnSVijZFGDNPHcklyvzL5WgdznIHYmb1s8Y5djSYWgGmjys=
  bucket: ts-demo-lamba-deploys
  local-dir: dist
  acl: public_read
  on:
    repo: threatstack/threatstack-to-aws-sns
